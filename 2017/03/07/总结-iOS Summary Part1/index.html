<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>总结-iOS Summary Part1 | Liberalism的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="liberalism,iOS,Swift,nodejs,JavaScript" />
  

  <meta name="description" content="文章大纲，便于浏览

01-iOS程序启动过程
 i.完整启动过程 
 ii.程序启动原理

02-浅拷贝-深拷贝
 i. 系统对象的 copy/mutableCopy
ii.自定义对象实现 Copy-MutableCopy
iii.copy 本质

03-View的生命周期

04-@property

05-事件传递和事件响应

06-KVC

01-iOS-App-startup-proce">
<meta property="og:type" content="article">
<meta property="og:title" content="总结-iOS Summary Part1">
<meta property="og:url" content="http://yoursite.com/2017/03/07/总结-iOS Summary Part1/index.html">
<meta property="og:site_name" content="Liberalism的博客">
<meta property="og:description" content="文章大纲，便于浏览

01-iOS程序启动过程
 i.完整启动过程 
 ii.程序启动原理

02-浅拷贝-深拷贝
 i. 系统对象的 copy/mutableCopy
ii.自定义对象实现 Copy-MutableCopy
iii.copy 本质

03-View的生命周期

04-@property

05-事件传递和事件响应

06-KVC

01-iOS-App-startup-proce">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E4%B8%8E%E4%BB%A3%E7%90%86.png">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-01">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-02">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-03.png">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-04.png">
<meta property="og:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/View%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png">
<meta property="og:updated_time" content="2017-03-07T08:59:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="总结-iOS Summary Part1">
<meta name="twitter:description" content="文章大纲，便于浏览

01-iOS程序启动过程
 i.完整启动过程 
 ii.程序启动原理

02-浅拷贝-深拷贝
 i. 系统对象的 copy/mutableCopy
ii.自定义对象实现 Copy-MutableCopy
iii.copy 本质

03-View的生命周期

04-@property

05-事件传递和事件响应

06-KVC

01-iOS-App-startup-proce">
<meta name="twitter:image" content="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            iOS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            JS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            翻译
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#01-iOS-App-startup-process"><span class="toc-text">01-iOS-App-startup-process</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-ShallowCopy-DeepCopy"><span class="toc-text">02-ShallowCopy-DeepCopy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-View的生命周期"><span class="toc-text">03-View的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-property"><span class="toc-text">04-@property</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-事件传递和事件响应"><span class="toc-text">05-事件传递和事件响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-KVC"><span class="toc-text">06-KVC</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-总结-iOS Summary Part1" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">总结-iOS Summary Part1</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.03.07</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>John Doe</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="http://www.xiaolu520.com/2017/03/07/总结-iOS Summary Part1/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>文章大纲，便于浏览</p>
<ol>
<li><p><a href="https://github.com/liberalisman/2018-Interview-Preparation#01-ios-app-startup-process" target="_blank" rel="external">01-iOS程序启动过程</a></p>
<p> i.<a href="https://github.com/liberalisman/2018-Interview-Preparation#一启动完整过程" target="_blank" rel="external">完整启动过程 </a></p>
<p> ii.<a href="https://github.com/liberalisman/2018-Interview-Preparation#二程序启动原理" target="_blank" rel="external">程序启动原理</a></p>
</li>
<li><p><a href="https://github.com/liberalisman/2018-Interview-Preparation#02-shallowcopy-deepcopy" target="_blank" rel="external">02-浅拷贝-深拷贝</a></p>
<p> i. <a href="https://github.com/liberalisman/2018-Interview-Preparation#一系统对象的-copymutablecopy" target="_blank" rel="external">系统对象的 copy/mutableCopy</a></p>
<p>ii.<a href="https://github.com/liberalisman/2018-Interview-Preparation#二自定义对象实现-copy-mutablecopy" target="_blank" rel="external">自定义对象实现 Copy-MutableCopy</a></p>
<p>iii.<a href="https://github.com/liberalisman/2018-Interview-Preparation#三copy-本质" target="_blank" rel="external">copy 本质</a></p>
</li>
<li><p><a href="https://github.com/liberalisman/2018-Interview-Preparation#03-view的生命周期" target="_blank" rel="external">03-View的生命周期</a></p>
</li>
<li><p><a href="https://github.com/liberalisman/2018-Interview-Preparation#04-property" target="_blank" rel="external">04-@property</a></p>
</li>
<li><p><a href="https://github.com/liberalisman/iOS-Summary-Part1#05-事件传递和事件响应" target="_blank" rel="external">05-事件传递和事件响应</a></p>
</li>
<li><a href="https://github.com/liberalisman/iOS-Summary-Part1#06-kvc" target="_blank" rel="external">06-KVC</a></li>
</ol>
<h2 id="01-iOS-App-startup-process"><a href="#01-iOS-App-startup-process" class="headerlink" title="01-iOS-App-startup-process"></a>01-iOS-App-startup-process</h2><p>###一、启动完整过程</p>
<p><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.png" alt=""></p>
<p>1.<code>main</code>函数</p>
<p>2.<code>UIApplicationMain</code>函数</p>
<ul>
<li>创建<code>UIApplication</code>对象</li>
<li>创建<code>UIApplication的delegate</code>对象</li>
</ul>
<p>3.<code>delegate</code>对象开始处理(监听)系统事件(没有storyboard)</p>
<ul>
<li>程序启动完毕的时候, 就会调用代理的:<code>didFinishLaunchingWithOptions:</code>方法</li>
<li>在<code>application:didFinishLaunchingWithOptions</code>:中创建<code>UIWindow</code> 创建和设置<code>UIWindow</code>的<code>rootViewController</code></li>
<li>显示窗口</li>
</ul>
<p>4.根据<code>Info.plist</code>获得最主要<code>storyboard</code>的文件名,加载最主要的<code>storyboard</code>(有storyboard)</p>
<ul>
<li>创建<code>UIWindow</code></li>
<li>创建和设置<code>UIWindow</code>的<code>rootViewController</code></li>
<li>显示窗口</li>
</ul>
<p>###二、程序启动原理</p>
<p>1.<code>main</code>函数中执行了一个<code>UIApplicationMain</code>这个函数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="built_in">UIApplicationMain</span>(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[], <span class="built_in">NSString</span> *principalClassName, <span class="built_in">NSString</span> *delegateClassName);</div><div class="line"></div><div class="line">argc、argv：直接传递给<span class="built_in">UIApplicationMain</span>进行相关处理即可</div></pre></td></tr></table></figure>
<p>2.<code>principalClassName</code>：指定应用程序类名（app的象征），该类必须是<code>UIApplication</code>(或子类)。如果为<code>nil</code>,则用<code>UIApplication</code>类作为默认值</p>
<p>3.<code>delegateClassName</code>：指定应用程序的代理类，该类必须遵守<code>UIApplicationDelegate</code>协议</p>
<p>4.<code>UIApplicationMain</code>函数会根据<code>principalClassName</code>创建<code>UIApplication</code>对象，根据<code>delegateClassName</code>创建一个<code>delegate</code>对象，并将该<code>delegate</code>对象赋值给<code>UIApplication</code>对象中的<code>delegate</code>属性</p>
<p>5.接着会建立应用程序的<code>Main Runloop</code>（事件循环），进行事件的处理(首先会在程序完毕后调用<code>delegate</code>对象的<code>application:didFinishLaunchingWithOptions</code>:方法)</p>
<p>程序正常退出时<code>UIApplicationMain</code>函数才返回</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])&#123; <span class="keyword">@autoreleasepool</span> &#123; </div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">* argc: 系统或者用户传入的参数个数</div><div class="line">* argv: 系统或者用户传入的实际参数 </div><div class="line">* 1.根据传入的第三个参数创建UIApplication对象 </div><div class="line">* 2.根据传入的第四个产生创建UIApplication对象的代理</div><div class="line">* 3.设置刚刚创建出来的代理对象为UIApplication的代理 </div><div class="line">* 4.开启一个事件循环 </div><div class="line">**/ </div><div class="line"><span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="string">@"UIApplication"</span>, <span class="string">@"YYAppDelegate"</span>); &#125;&#125;</div></pre></td></tr></table></figure>
<p>启动与代理：<br><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E4%B8%8E%E4%BB%A3%E7%90%86.png" alt=""></p>
<h2 id="02-ShallowCopy-DeepCopy"><a href="#02-ShallowCopy-DeepCopy" class="headerlink" title="02-ShallowCopy-DeepCopy"></a>02-ShallowCopy-DeepCopy</h2><p>简要总结一下什么是浅拷贝，什么是深拷贝</p>
<blockquote>
<p>深拷贝就是内容拷贝</p>
<p>浅拷贝就是指针拷贝</p>
</blockquote>
<p>###一.系统对象的 copy/mutableCopy</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *string = <span class="string">@"LiMing"</span>;</div><div class="line">    </div><div class="line"><span class="built_in">NSString</span> *copyString = [string <span class="keyword">copy</span>];</div><div class="line">    </div><div class="line"><span class="built_in">NSString</span> *mutableString = [string mutableCopy];</div><div class="line">    </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"string = %p"</span>,string);</div><div class="line">    </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"copyString = %p"</span>,copyString);</div><div class="line">    </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"mutableString = %p "</span>,mutableString);</div><div class="line"></div><div class="line">结论：</div><div class="line"><span class="number">1.</span>string 和 copyString 他们只是二个不同的指针，指向内存中的同一块地址，<span class="keyword">copy</span> 只是指针复制</div><div class="line"><span class="number">2.</span>string 和 mutableString 打印出来的地址不同，是因为两个指针指向的地址本就不同，mutableCopy 是内容复制</div><div class="line"></div><div class="line">注意：其他对象 <span class="built_in">NSArray</span> 、<span class="built_in">NSMutableArray</span> 、<span class="built_in">NSDictionary</span> 、<span class="built_in">NSMutableDictionary</span> 一样适用</div></pre></td></tr></table></figure>
<p>规律可以从这张图看出来</p>
<p><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-01" alt=""></p>
<p><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-02" alt=""></p>
<p>###二.自定义对象实现 Copy-MutableCopy</p>
<ul>
<li>copy</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">GZQPerson *person = [[GZQPerson alloc] init];</div><div class="line">person.age = <span class="number">20</span>;</div><div class="line">person.name = <span class="string">@"GZQ"</span>;</div><div class="line">GZQPerson *copyP = [person <span class="keyword">copy</span>];  <span class="comment">// 这里崩溃</span></div></pre></td></tr></table></figure>
<p>崩溃：<br><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-03.png" alt=""></p>
<p>看崩溃信息GZQPerson应该先实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone;</div></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"GZQPerson.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GZQPerson</span> ()&lt;<span class="title">NSCopying</span>,<span class="title">NSMutableCopying</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GZQPerson</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</div><div class="line"></div><div class="line">    GZQPerson *person = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] init];</div><div class="line">    person.age = <span class="keyword">self</span>.age;</div><div class="line">    person.name = <span class="keyword">self</span>.name;</div><div class="line">    <span class="keyword">return</span> person;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</div><div class="line"></div><div class="line">    GZQPerson *person = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] init];</div><div class="line">    person.age = <span class="keyword">self</span>.age;</div><div class="line">    person.name = <span class="keyword">self</span>.name;</div><div class="line">    <span class="keyword">return</span> person;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"GZQPerson.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    </div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    GZQPerson *person = [[GZQPerson alloc] init];</div><div class="line">    person.age = <span class="number">20</span>;</div><div class="line">    person.name = <span class="string">@"GZQ"</span>;</div><div class="line">    GZQPerson *copyP = [person <span class="keyword">copy</span>];</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"copyP=%p"</span>,copyP);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"person=%p"</span>,person);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"person=%p"</span>,copyP.name);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"person=%p"</span>,person.name);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E6%B5%85%E6%8B%B7%E8%B4%9D-04.png" alt=""></p>
<p>可以看出虽然指针的地址不同，但是存储的地址是一致的。</p>
<p>###三.copy 本质</p>
<p><code>property copy</code> 实际上就对name干了这个：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line">property <span class="keyword">copy</span> 实际上就对name干了这个：</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name</div><div class="line">&#123;</div><div class="line">    _name = [name <span class="keyword">copy</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>strong</code>是不执行<code>Copy</code>操作的</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</div><div class="line"></div><div class="line"><span class="built_in">NSMutableString</span> *string = [<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"深拷贝-浅拷贝"</span>];</div><div class="line"></div><div class="line">GZQPerson *person = [[GZQPerson alloc] init];</div><div class="line">person.name = string;</div><div class="line"></div><div class="line"><span class="comment">// 可以改变person.name的值，因为其内部没有生成新的对象</span></div><div class="line">[string appendString:<span class="string">@"LALALA"</span>];</div><div class="line"></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"name = %@"</span>, person.name);</div></pre></td></tr></table></figure>
<h2 id="03-View的生命周期"><a href="#03-View的生命周期" class="headerlink" title="03-View的生命周期"></a>03-View的生命周期</h2><ul>
<li>读懂这一张图即可<br><img src="http://okhqmtd8q.bkt.clouddn.com/image/jpg/View%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt=""></li>
</ul>
<h2 id="04-property"><a href="#04-property" class="headerlink" title="04-@property"></a>04-@property</h2><blockquote>
<p>@property 的本质是什么？ivar、getter、setter 是如何生成并添加到这个类中的</p>
</blockquote>
<p>@property 的本质.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> = ivar + <span class="keyword">getter</span> + <span class="keyword">setter</span>;</div></pre></td></tr></table></figure>
<p>下面解释下：</p>
<blockquote>
<p>“属性” (property)有两大概念：ivar（实例变量）、存取方法（access method ＝ getter + setter）。</p>
<p>“属性” (property)作为 Objective-C 的一项特性，主要的作用就在于封装对象中的数据。 Objective-C 对象通常会把其所需要的数据保存为各种实例变量。实例变量一般通过“存取方法”(access method)来访问。其中，“获取方法” (getter)用于读取变量值，而“设置方法” (setter)用于写入变量值。这个概念已经定型，并且经由“属性”这一特性而成为 Objective-C 2.0 的一部分。 而在正规的 Objective-C 编码风格中，存取方法有着严格的命名规范。 正因为有了这种严格的命名规范，所以 Objective-C 这门语言才能根据名称自动创建出存取方法。其实也可以把属性当做一种关键字，其表示:</p>
</blockquote>
<p>编译器会自动写出一套存取方法，用以访问给定类型中具有给定名称的变量。 所以你也可以这么说：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> = <span class="keyword">getter</span> + <span class="keyword">setter</span>;</div></pre></td></tr></table></figure>
<p>例如下面这个类：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>上述代码写出来的类与下面这种写法等效：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="built_in">NSString</span> *)firstName;</div><div class="line">- (<span class="keyword">void</span>)setFirstName:(<span class="built_in">NSString</span> *)firstName;</div><div class="line">- (<span class="built_in">NSString</span> *)lastName;</div><div class="line">- (<span class="keyword">void</span>)setLastName:(<span class="built_in">NSString</span> *)lastName;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>property</code>在<code>runtime</code>中是<code>objc_property_t</code>定义如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_property *objc_property_t;</div></pre></td></tr></table></figure>
<p>而<code>objc_property</code>是一个结构体，包括<code>name</code>和<code>attributes</code>，定义如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> property_t &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *attributes;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>而<code>attributes</code>本质是<code>objc_property_attribute_t</code>，定义了<code>property</code>的一些属性，定义如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// Defines a property attribute</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;           <span class="comment">/**&lt; The name of the attribute */</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *value;          <span class="comment">/**&lt; The value of the attribute (usually empty) */</span></div><div class="line">&#125; objc_property_attribute_t;</div></pre></td></tr></table></figure>
<blockquote>
<p>而attributes的具体内容是什么呢？其实，包括：类型，原子性，内存语义和对应的实例变量。</p>
</blockquote>
<p>例如：我们定义一个<code>string</code>的<code>property</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *string;</div></pre></td></tr></table></figure>
<p>通过 <code>property_getAttributes(property)</code>获取到<code>attributes</code>并打印出来之后的结果为</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">T<span class="string">@"NSString"</span>,C,N,V_string</div></pre></td></tr></table></figure>
<p>其中<code>T</code>就代表类型，可参阅<code>Type Encodings</code>，<code>C</code>就代表<code>Copy</code>，<code>N</code>代表<code>nonatomic</code>，<code>V</code>就代表对于的实例变量。</p>
<blockquote>
<p>ivar、getter、setter 是如何生成并添加到这个类中的?</p>
</blockquote>
<p><strong>“自动合成”( autosynthesis)</strong></p>
<blockquote>
<p>完成属性定义后，编译器会自动编写访问这些属性所需的方法，此过程叫做“自动合成”(autosynthesis)。需要强调的是，这个过程由编译 器在编译期执行，所以编辑器里看不到这些“合成方法”(synthesized method)的源代码。除了生成方法代码 getter、setter 之外，编译器还要自动向类中添加适当类型的实例变量，并且在属性名前面加下划线，以此作为实例变量的名字。在前例中，会生成两个实例变量，其名称分别为 _firstName 与 _lastName。也可以在类的实现代码里通过@synthesize 语法来指定实例变量的名字.</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line"><span class="keyword">@synthesize</span> firstName = _myFirstName;</div><div class="line"><span class="keyword">@synthesize</span> lastName = _myLastName;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><strong>我为了搞清属性是怎么实现的,曾经反编译过相关的代码,他大致生成了五个东西</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> OBJC_IVAR_$类名$属性名称 ：该属性的“偏移量” (offset)，这个偏移量是“硬编码” (hardcode)，表示该变量距离存放对象的内存区域的起始地址有多远。</div><div class="line"><span class="number">2.</span> <span class="keyword">setter</span> 与 <span class="keyword">getter</span> 方法对应的实现函数</div><div class="line"><span class="number">3.</span> ivar_list ：成员变量列表</div><div class="line"><span class="number">4.</span> method_list ：方法列表</div><div class="line"><span class="number">5.</span> prop_list ：属性列表</div><div class="line">也就是说我们每次在增加一个属性,系统都会在 ivar_list 中添加一个成员变量的描述,在 method_list 中增加 <span class="keyword">setter</span> 与 <span class="keyword">getter</span> 方法的描述,在属性列表中增加一个属性的描述,然后计算该属性在对象中的偏移量,然后给出 <span class="keyword">setter</span> 与 <span class="keyword">getter</span> 方法对应的实现,在 <span class="keyword">setter</span> 方法中从偏移量的位置开始赋值,在 <span class="keyword">getter</span> 方法中从偏移量开始取值,为了能够读取正确字节数,系统对象偏移量的指针类型进行了类型强转.</div></pre></td></tr></table></figure>
<p><strong>属性可以拥有的特质分为四类:</strong></p>
<ul>
<li><p>原子性— nonatomic 特质,在默认情况下，由编译器合成的方法会通过锁定机制确保其原子性(atomicity)。如果属性具备 nonatomic 特质，则不使用自旋锁。请注意，尽管没有名为“atomic”的特质(如果某属性不具备 nonatomic 特质，那它就是“原子的” ( atomic) )，但是仍然可以在属性特质中写明这一点，编译器不会报错。若是自己定义存取方法，那么就应该遵从与属性特质相符的原子性。</p>
</li>
<li><p>读/写权限—readwrite(读写)、readonly (只读)</p>
</li>
<li><p>内存管理语义—assign、strong、 weak、unsafe_unretained、copy</p>
</li>
<li>方法名—getter=<name> 、setter=<name></name></name></li>
</ul>
<p><strong>getter=<name>的样式：</name></strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isOn) <span class="built_in">BOOL</span> on;</div><div class="line">     </div><div class="line">(`<span class="keyword">setter</span>=`这种不常用，也不推荐使用。故不在这里给出写法。）</div></pre></td></tr></table></figure>
<p><strong>setter=<name>一般用在特殊的情境下，比如</name></strong>：</p>
<blockquote>
<p>在数据反序列化、转模型的过程中，服务器返回的字段如果以 init 开头，所以你需要定义一个 init 开头的属性，但默认生成的 setter 与 getter 方法也会以 init 开头，而编译器会把所有以 init 开头的方法当成初始化方法，而初始化方法只能返回 self 类型，因此编译器会报错。</p>
</blockquote>
<p><strong>这时你就可以使用下面的方式来避免编译器报错：</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">getter</span>=p_initBy, <span class="keyword">setter</span>=setP_initBy:)<span class="built_in">NSString</span> *initBy;</div></pre></td></tr></table></figure>
<p><strong>另外也可以用关键字进行特殊说明，来避免编译器报错</strong>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readwrite</span>, <span class="keyword">copy</span>, <span class="keyword">null_resettable</span>) <span class="built_in">NSString</span> *initBy;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)initBy __attribute__((objc_method_family(none)));</div><div class="line"></div><div class="line"><span class="number">1.</span> 不常用的：<span class="keyword">nonnull</span>,<span class="keyword">null_resettable</span>,<span class="keyword">nullable</span></div><div class="line"></div><div class="line">注意：很多人会认为如果属性具备 <span class="keyword">nonatomic</span> 特质，则不使用 “同步锁”。其实在属性设置方法中使用的是自旋锁，自旋锁相关代码如下：</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> reallySetProperty(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, <span class="keyword">id</span> newValue, ptrdiff_t offset, <span class="keyword">bool</span> atomic, <span class="keyword">bool</span> <span class="keyword">copy</span>, <span class="keyword">bool</span> mutableCopy)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (offset == <span class="number">0</span>) </div><div class="line">    &#123;</div><div class="line">        object_setClass(<span class="keyword">self</span>, newValue);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">id</span> oldValue;</div><div class="line">    <span class="keyword">id</span> *slot = (<span class="keyword">id</span>*) ((<span class="keyword">char</span>*)<span class="keyword">self</span> + offset);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">copy</span>) </div><div class="line">    &#123;</div><div class="line">        newValue = [newValue copyWithZone:<span class="literal">nil</span>];</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (mutableCopy) </div><div class="line">    &#123;</div><div class="line">        newValue = [newValue mutableCopyWithZone:<span class="literal">nil</span>];</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (*slot == newValue) <span class="keyword">return</span>;</div><div class="line">        newValue = objc_retain(newValue);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!atomic) </div><div class="line">    &#123;</div><div class="line">        oldValue = *slot;</div><div class="line">        *slot = newValue;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">        spinlock_t&amp; slotlock = PropertyLocks[slot];</div><div class="line">        slotlock.lock();</div><div class="line">        oldValue = *slot;</div><div class="line">        *slot = newValue;        </div><div class="line">        slotlock.unlock();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    objc_release(oldValue);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> objc_setProperty(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, ptrdiff_t offset, <span class="keyword">id</span> newValue, <span class="built_in">BOOL</span> atomic, <span class="keyword">signed</span> <span class="keyword">char</span> shouldCopy) </div><div class="line">&#123;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">copy</span> = (shouldCopy &amp;&amp; shouldCopy != MUTABLE_COPY);</div><div class="line">    <span class="keyword">bool</span> mutableCopy = (shouldCopy == MUTABLE_COPY);</div><div class="line">    reallySetProperty(<span class="keyword">self</span>, _cmd, newValue, offset, atomic, <span class="keyword">copy</span>, mutableCopy);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="05-事件传递和事件响应"><a href="#05-事件传递和事件响应" class="headerlink" title="05-事件传递和事件响应"></a>05-事件传递和事件响应</h2><p>这部分知识如果自己总结，篇幅较长。可以参考<a href="http://www.jianshu.com/p/2e074db792ba" target="_blank" rel="external">以下文章</a></p>
<h2 id="06-KVC"><a href="#06-KVC" class="headerlink" title="06-KVC"></a>06-KVC</h2><p><strong>Key-Value Coding (KVC)</strong></p>
<blockquote>
<p>KVC（Key-value coding）键值编码，单看这个名字可能不太好理解。其实翻译一下就很简单了，就是指iOS的开发中，可以允许开发者通过Key名直接访问对象的属性，或者给对象的属性赋值。而不需要调用明确的存取方法。这样就可以在运行时动态在访问和修改对象的属性。而不是在编译时确定，这也是iOS开发中的黑魔法之一。很多高级的iOS开发技巧都是基于KVC实现的。目前网上关于KVC的文章在非常多，有的只是简单地说了下用法，有的讲得深入但是在使用场景和最佳实践没有说明，我写下这遍文章就是给大家详解一个最完整最详细的KVC。</p>
</blockquote>
<p><strong>KVC在iOS中的定义</strong></p>
<p>无论是<code>Swift</code>还是<code>Objective-C</code>，<code>KVC</code>的定义都是对<code>NSObject</code>的扩展来实现的(<code>Objective-C</code>中有个显式的<code>NSKeyValueCoding</code>类别名，而<code>Swift</code>没有，也不需要)所以对于所有继承了<code>NSObject</code>在类型，都能使用<code>KVC</code>(一些纯<code>Swift</code>类和结构体是不支持<code>KVC</code>的)，下面是<code>KVC</code>最为重要的四个方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;                          <span class="comment">//直接通过Key来取值</span></div><div class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;          <span class="comment">//通过Key来设值</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;                  <span class="comment">//通过KeyPath来取值</span></div><div class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;  <span class="comment">//通过KeyPath来设值</span></div></pre></td></tr></table></figure>
<p>当然<code>NSKeyValueCoding</code>类别中还有其他的一些方法，下面列举一些</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)accessInstanceVariablesDirectly;</div><div class="line"><span class="comment">//默认返回YES，表示如果没有找到Set&lt;Key&gt;方法的话，会按照_key，_iskey，key，iskey的顺序搜索成员，设置成NO就不这样搜索</span></div><div class="line">- (<span class="built_in">BOOL</span>)validateValue:(<span class="keyword">inout</span> <span class="keyword">id</span> __<span class="keyword">nullable</span> * __<span class="keyword">nonnull</span>)ioValue forKey:(<span class="built_in">NSString</span> *)inKey error:(<span class="keyword">out</span> <span class="built_in">NSError</span> **)outError;</div><div class="line"><span class="comment">//KVC提供属性值确认的API，它可以用来检查set的值是否正确、为不正确的值做一个替换值或者拒绝设置新值并返回错误原因。</span></div><div class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKey:(<span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//这是集合操作的API，里面还有一系列这样的API，如果属性是一个NSMutableArray，那么可以用这个方法来返回</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//如果Key不存在，且没有KVC无法搜索到任何和Key有关的字段或者属性，则会调用这个方法，默认是抛出异常</span></div><div class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//和上一个方法一样，只不过是设值。</span></div><div class="line">- (<span class="keyword">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key;</div><div class="line"><span class="comment">//如果你在SetValue方法时面给Value传nil，则会调用这个方法</span></div><div class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</div><div class="line"><span class="comment">//输入一组key,返回该组key对应的Value，再转成字典返回，用于将Model转到字典。</span></div></pre></td></tr></table></figure>
<p>上面的这些方法在碰到特殊情况或者有特殊需求还是会用到的，所以也是可以了解一下。后面的代码示例会有讲到其中的一些方法。<br>同时苹果对一些容器类比如NSArray或者NSSet等，KVC有着特殊的实现。建议有基础的或者英文好的开发者直接去看苹果的官方文档，相信你会对KVC的理解更上一个台阶。</p>
<p><strong>KVC是怎么寻找Key的</strong></p>
<p>KVC是怎么使用的，我相信绝大多数的开发者都很清楚，我在这里就不再写简单的使用KVC来设值和取值的代码了，首页我们来探讨KVC在内部是按什么样的顺序来寻找key的。<br>当调用<code>setValue：</code>属性值 <code>forKey：``@”name“</code>的代码时，底层的执行机制如下：</p>
<ul>
<li><p>程序优先调用<code>set&lt;Key&gt;:</code>属性值方法，代码通过<code>setter</code>方法完成设置。注意，这里的<code>&lt;key&gt;</code>是指成员变量名，首字母大清写要符合<code>KVC</code>的全名规则，下同</p>
</li>
<li><p>如果没有找到<code>setName：</code>方法，<code>KVC</code>机制会检查<code>+ (BOOL)accessInstanceVariablesDirectly</code>方法有没有返回<code>YES</code>，默认该方法会返回<code>YES</code>，如果你重写了该方法让其返回<code>NO</code>的话，那么在这一步KVC会执行<code>setValue：forUNdefinedKey：</code>方法，不过一般开发者不会这么做。所以KVC机制会搜索该类里面有没有名为<code>_&lt;key&gt;</code>的成员变量，无论该变量是在类接口部分定义，还是在类实现部分定义，也无论用了什么样的访问修饰符，只在存在以<code>_&lt;key&gt;</code>命名的变量，<code>KVC</code>都可以对该成员变量赋值。</p>
</li>
<li><p>如果该类即没有<code>set&lt;Key&gt;：</code>方法，也没有<code>_&lt;key&gt;</code>成员变量，<code>KVC</code>机制会搜索<code>_is&lt;Key&gt;</code>的成员变量，</p>
</li>
<li><p>和上面一样，如果该类即没有<code>set&lt;Key&gt;：</code>方法，也没有<code>_&lt;key&gt;</code>和<code>_is&lt;Key&gt;</code>成员变量，<code>KVC</code>机制再会继续搜索<code>&lt;key&gt;</code>和<code>is&lt;Key&gt;</code>的成员变量。再给它们赋值。</p>
</li>
<li><p>如果上面列出的方法或者成员变量都不存在，系统将会执行该对象的<code>setValue：forUNdefinedKey：</code>方法，默认是抛出异常。</p>
</li>
</ul>
<p>如果开发者想让这个类禁用<code>KVC</code>里，那么重写<code>+ (BOOL)accessInstanceVariablesDirectly</code>方法让其返回NO即可，这样的话如果<code>KVC</code>没有找到<code>set&lt;Key&gt;:</code>属性名时，会直接用<code>setValue：forUNdefinedKey：</code>方法。</p>

    
  </div>
</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持Liberalism</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/qr-wechat.png" alt="">
          </li>
        
          <li class="item">
            <img src="/images/qr-alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/02/21/源码解析-SDWebImage/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              iOS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              JS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              翻译
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'Liberalism';
    
    var disqus_url = 'http://yoursite.com/2017/03/07/总结-iOS Summary Part1/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//Liberalism.disqus.com/count.js" async></script>



    




  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
